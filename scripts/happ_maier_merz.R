library(tidyverse)
library(magrittr)

munge_triangle <- function(str_in, lags) {
  tbl_triangle <- str_in %>%
    str_replace_all('\\.', '') %>%
    str_split('\n', simplify = TRUE) %>%
    str_split('[:space:]+', simplify = TRUE) %>%
    extract(, -1) %>%
    as_tibble() %>%
    map_dfc(as.numeric)

  names(tbl_triangle) <- c('ay', lags)

  tbl_triangle %>%
    tidyr::gather(lag, incremental_paid, -ay, na.rm = TRUE)
}

lags <- 0:10

triangle_a <- ' 0 14.492 7.746 949 467 814 234 1.718 104 15 49 4
  1 17.017 9.251 945 750 33 196 1.144 18 10 1 11
  2 19.563 12.265 1.302 1.099 967 1.237 1.838 1.093 276 643 0
  3 21.632 13.249 963 136 25 172 27 39 7 0 0
  4 22.672 9.677 1.779 153 95 1.265 31 1 45 0 8
  5 23.062 13.375 2.200 327 2.273 20 23 0 0 2 0
  6 23.588 11.713 1.660 4.569 1.662 256 0 39 0 32 2
  7 21.758 12.300 1.685 1.266 -28 -41 -49 -45 -26 0
  8 20.233 9.197 932 644 754 2.452 161 34 0
  9 24.984 12.632 1.931 415 1.730 163 113 33
  10 24.260 13.555 1.585 1.679 123 147 32
  11 20.616 11.430 2.932 516 558 37
  12 18.814 11.499 3.363 1.711 97
  13 18.563 13.492 16.370 2.704
  14 18.457 11.089 2.064
  15 19.533 9.833
  16 17.620'

triangle_b <- ' 0 16.651 8.206 -468 -152 5 4 6 0 1 0 0
  1 16.292 8.129 1.713 195 426 35 68 50 55 0 11
  2 16.658 10.566 1.736 618 1.272 442 572 15 38 749 2
  3 19.715 10.690 968 2.098 154 197 100 63 3.519 24 149
  4 21.220 8.815 2.969 896 151 1.146 26 20 0 0 2
  5 21.302 10.582 2.237 952 7 1.183 14 0 26 70 -9
  6 17.201 7.493 1.574 518 1.685 25 2 56 -8 71 7
  7 15.835 11.668 1.728 122 493 -10 4 1 1 0
  8 17.560 8.550 2.373 908 1.163 389 127 501 2
  9 21.051 12.279 2.387 690 372 2.024 14 0
  10 20.368 9.832 1.285 460 43 186 0
  11 18.623 11.160 942 892 8 28
  12 18.112 12.040 1.662 5.654 979
  13 17.744 10.346 2.134 599
  14 17.993 8.956 869
  15 19.082 11.403
  16 17.809'

tbl_triangle <- triangle_a %>%
  munge_triangle(lags)
